# üîÑ Agent Migration Guide

## –ü—Ä–æ–±–ª–µ–º–∞
–£ –Ω–∞—Å –µ—Å—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É `users` (role: AGENT) –∏ —Ç–∞–±–ª–∏—Ü–µ–π `agents`. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ.

## –†–µ—à–µ–Ω–∏–µ
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `User` + `AgentProfile`, –≥–¥–µ:
- `User` - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (name, email, role)
- `AgentProfile` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤

## üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (Development)
```bash
# 1. –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump $DATABASE_URL > backup_before_migration.sql

# 2. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å AgentProfile –≤ schema.prisma
# (—Å–º–æ—Ç—Ä–∏ schema-new.prisma)

# 3. –°–æ–∑–¥–∞–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate dev --name add-agent-profile

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
npx tsx prisma/migrate-agents.ts
```

### –≠—Ç–∞–ø 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
```bash
# 1. –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ API endpoints
# 2. –û–±–Ω–æ–≤–ª—è–µ–º React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
# 3. –û–±–Ω–æ–≤–ª—è–µ–º Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
# 4. –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
```

### –≠—Ç–∞–ø 3: –û—á–∏—Å—Ç–∫–∞ (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
```bash
# 1. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –∏–∑ schema.prisma
# 2. –°–æ–∑–¥–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate dev --name remove-old-agent-table

# 3. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∏–ø—ã
npx prisma generate
```

## üöÄ Production –º–∏–≥—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:
1. ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤ development
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è production –±–∞–∑—ã
3. ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
```bash
# 1. –î–µ–ø–ª–æ–π —Å –æ–±–µ–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ (Agent + AgentProfile)
vercel --prod

# 2. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ production
npx tsx prisma/migrate-agents.ts

# 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–¥–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AgentProfile
# (—á–µ—Ä–µ–∑ feature flag –∏–ª–∏ –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π)

# 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

# 5. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –º–æ–¥–µ–ª–∏ Agent (–æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π)
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É
- –ù–æ–≤—ã–µ –ø–æ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∫ nullable
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ —á–µ—Ä–µ–∑ `npm run migrate:rollback`

### –ü—Ä–æ–≤–µ—Ä–∫–∏:
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π –¥–æ/–ø–æ—Å–ª–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–≤—è–∑–µ–π
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞:
```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫:
npx tsx prisma/migrate-agents.ts rollback
# –ò–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
psql $DATABASE_URL < backup_before_migration.sql
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –î–æ:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ users
id | email | name | role
-- –¢–∞–±–ª–∏—Ü–∞ agents (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ!)
id | name | email | rating | bio | userId
```

### –ü–æ—Å–ª–µ:
```sql
-- –¢–∞–±–ª–∏—Ü–∞ users
id | email | name | role
-- –¢–∞–±–ª–∏—Ü–∞ agent_profiles (—Ç–æ–ª—å–∫–æ –¥–æ–ø. –¥–∞–Ω–Ω—ã–µ)
id | userId | rating | bio | phone | specialties
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ä–æ–ª–∏
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### API Endpoints:
- `/api/agents` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `User` join `AgentProfile`
- `/api/admin/agents` ‚Üí –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
- –ù–æ–≤—ã–µ —Ç–∏–ø—ã –≤ TypeScript

### React Components:
- `AgentsClient` ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã
- `AdminAgentsTab` ‚Üí –Ω–æ–≤—ã–µ –ø–æ–ª—è
- –§–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- –ù–æ–≤—ã–µ Prisma –∑–∞–ø—Ä–æ—Å—ã —Å `include: { agentProfile: true }`
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- –ö–∞—Å–∫–∞–¥–Ω—ã–µ —É–¥–∞–ª–µ–Ω–∏—è

## ‚ö†Ô∏è –í–∞–∂–Ω–æ!

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∞–≥–µ–Ω—Ç—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
3. **Backup**: –í—Å–µ–≥–¥–∞ –∏–º–µ—Ç—å —Å–≤–µ–∂–∏–π backup –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
4. **Rollback –ø–ª–∞–Ω**: –ë—ã—Ç—å –≥–æ—Ç–æ–≤—ã–º –∫ –æ—Ç–∫–∞—Ç—É

## üìù Checklist

### Development:
- [ ] –°–æ–∑–¥–∞–Ω backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è schema
- [ ] –ó–∞–ø—É—â–µ–Ω —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ API
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω—ã React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Production:
- [ ] –°–æ–∑–¥–∞–Ω production backup
- [ ] –î–µ–ø–ª–æ–π —Å –Ω–æ–≤–æ–π —Å—Ö–µ–º–æ–π
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ production
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- [ ] –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—á–µ—Ä–µ–∑ –≤—Ä–µ–º—è)

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~30-60 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö)
**–†–∏—Å–∫**: –ù–∏–∑–∫–∏–π (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ backup –∏ –ø–ª–∞–Ω–∞ –æ—Ç–∫–∞—Ç–∞)
**–ü–æ–ª—å–∑–∞**: –í—ã—Å–æ–∫–∞—è (—á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ª–µ–≥–∫–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏)